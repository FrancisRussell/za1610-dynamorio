<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>DynamoRIO API: Symbol Access Library</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
<link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />
</head><body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="contents">


<h1><a class="anchor" id="page_drsyms">Symbol Access Library </a></h1><p>The <code>drsyms</code> DynamoRIO Extension provides symbol information. Currently drsyms supports reading symbol information from Windows PDB files and Linux ELF or Windows PECOFF files with DWARF2 line information.</p>
<ul>
<li><a class="el" href="page__drsyms.html#sec_drsyms_setup">Setup</a></li>
<li><a class="el" href="page__drsyms.html#sec_drsyms_api">API</a></li>
</ul>
<h2><a class="anchor" id="sec_drsyms_setup">
Setup</a></h2>
<p>To use <code>drsyms</code> with your client simply include this line in your client's <code>CMakeLists.txt</code> file:</p>
<div class="fragment"><pre class="fragment"> use_DynamoRIO_extension(clientname drsyms) 
</pre></div><p>That will automatically set up the include path and library dependence.</p>
<p>The <code>drsyms</code> library on Windows relies on the <code>dbghelp.dll</code> library from Microsoft. You will need to download the Debugging Tools for Windows package from <a href="http://www.microsoft.com/whdc/devtools/debugging/default.mspx">http://www.microsoft.com/whdc/devtools/debugging/default.mspx</a> and place the <code>dbghelp.dll</code> in the same directory as either <code>drsyms.dll</code> or as your client library.</p>
<p>More recent versions of <code>dbghelp.dll</code> on Windows can use significant amounts of stack space. We have observed usage of 36KB. This is within the default stack size for a DynamoRIO client, but be aware if trying to trim the stack size via the DynamoRIO runtime option <code>-stack_size</code> that anything lower than 36KB is likely to be problematic on Windows.</p>
<p>On Windows, <code>drsyms</code> does support Cygwin and MinGW symbols, and will find file and line information if in DWARF2 format. The <code>stabs</code> format is not supported. Cygwin and MinGW gcc versions prior to 4.3 use <code>stabs</code> by default; pass the <code>-ggdb</code> flag to request DWARF2.</p>
<p>The <code>drsyms</code> library on Linux uses bundled copies of <code>libelf</code>, <code>libdwarf</code>, and <code>libelftc</code> built from the <a href="http://elftoolchain.sourceforge.net">elftoolchain</a> project and requires no setup.</p>
<h2><a class="anchor" id="sec_drsyms_api">
API</a></h2>
<p>All functions return a success code of type <a class="el" href="group__drsyms.html#ga78793b36b5a0f529fb746b7ed0072442">drsym_error_t</a>.</p>
<p>Prior to use, <code>drsyms</code> must be initialized by a call to <a class="el" href="group__drsyms.html#ga8f826a91db73acb16acb6649d26a86cd">drsym_init()</a>. The <code>drsyms</code> API will eventually support both sideline and online use, and the parameter to <a class="el" href="group__drsyms.html#ga8f826a91db73acb16acb6649d26a86cd">drsym_init()</a> will specify the symbol server to use for sideline use. Today only online use is supported and <code>NULL</code> should be passed.</p>
<p>Symbol lookup is supported in both directions: from an address to a symbol via <a class="el" href="group__drsyms.html#ga201e8a9bf6746cbfd232bc4e4a243d2b">drsym_lookup_address()</a>, and from a symbol to an address via <a class="el" href="group__drsyms.html#ga2e6f4d91b65fc835c047c8ca23c83d06">drsym_lookup_symbol()</a>. All symbols in a given module can be enumerated via <a class="el" href="group__drsyms.html#ga260c78496165b54b9a97d0a5e1f6f4d8">drsym_enumerate_symbols()</a>, though on Windows using <a class="el" href="group__drsyms.html#gad6eb2e2cee8fba5ee6eb439905b3ecb9">drsym_search_symbols()</a> for a particular match where a non-full search is not required (i.e., the search is only targeting function symbols) is significantly faster and uses less memory than a full enumeration. In fact, <a class="el" href="group__drsyms.html#gad6eb2e2cee8fba5ee6eb439905b3ecb9">drsym_search_symbols()</a> is usually faster than <a class="el" href="group__drsyms.html#ga2e6f4d91b65fc835c047c8ca23c83d06">drsym_lookup_symbol()</a>.</p>
<p>For C++ applications, each routine that handles symbols accepts a <code>flags</code> argument that controls how or whether C++ symbols are demangled or undecorated. Currently there are three modes:</p>
<ul>
<li><code>DRSYM_LEAVE_MANGLED:</code> Matches against or returns the mangled C++ symbol.</li>
<li><code>DRSYM_DEMANGLE:</code> Matches against or returns a "short" demangled C++ symbol. On Linux, both templates and parameters are collapsed to &lt;&gt; and () respectively. On Windows, templates are still expanded, and parameters are omitted without parentheses.</li>
<li><code>DRSYM_DEMANGLE_FULL:</code> Matches against or returns the fully demangled C++ symbol with both template arguments and parameter types.</li>
<li><code>DRSYM_DEFAULT_FLAGS:</code> This is equivalent to <code>DRSYM_DEMANGLE</code>.</li>
</ul>
<p>On Windows, this functionality is reduced due to the limitations of <code>dbghelp.dll</code>. For all routines except <a class="el" href="group__drsyms.html#gad582a65dc1308335633e0c451035dbe0">drsym_demangle_symbol()</a>, no matter what flags the user passes, all symbols returned or searched use the default demangling on Windows, which includes template arguments and excludes parameter types.</p>
<p>For an example of usage see the <code>instrcalls</code> sample client distributed with DynamoRIO.</p>
<p>When finished with the library, call <a class="el" href="group__drsyms.html#ga5d70a336713dd08ebe256c2eb964d3ae">drsym_exit()</a>. </p>
</div>
<hr size="1"><address style="text-align: center;"><small>
<img border=0 src="favicon.png"> &nbsp; DynamoRIO API version 3.2.0 --- Wed Mar 28 12:55:33 2012 
&nbsp; <img border=0 src="favicon.png">
</body>
</html>
