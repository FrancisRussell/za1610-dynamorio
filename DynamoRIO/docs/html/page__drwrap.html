<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>DynamoRIO API: Function Wrapping and Replacing Extension</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
<link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />
</head><body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="contents">


<h1><a class="anchor" id="page_drwrap">Function Wrapping and Replacing Extension </a></h1><p>The <code>drwrap</code> DynamoRIO Extension provides function wrapping and replacing support.</p>
<ul>
<li><a class="el" href="page__drwrap.html#sec_drwrap_setup">Setup</a></li>
<li><a class="el" href="page__drwrap.html#sec_drwrap_api">API</a></li>
<li><a class="el" href="page__drwrap.html#sec_drwrap_license">LGPL 2.1 License</a></li>
</ul>
<h2><a class="anchor" id="sec_drwrap_setup">
Setup</a></h2>
<p>To use <code>drwrap</code> with your client simply include this line in your client's <code>CMakeLists.txt</code> file:</p>
<div class="fragment"><pre class="fragment"> use_DynamoRIO_extension(clientname drwrap) 
</pre></div><p>That will automatically set up the include path and library dependence.</p>
<p>Initialize and clean up <code>drwrap</code> by calling <a class="el" href="group__drwrap.html#ga23837833101ebc340ac7de6e8340bb4a">drwrap_init()</a> and <a class="el" href="group__drwrap.html#ga0e58babc53301c4ade4027dc1e09a088">drwrap_exit()</a>.</p>
<h2><a class="anchor" id="sec_drwrap_api">
API</a></h2>
<p>The first step in replacing or wrapping is to determine the address of the target application function. For functions exported by an application library, use <a class="el" href="dr__tools_8h.html#a8da7923ecc4e020e31442bcc8d9f8d3e">dr_get_proc_address()</a> to locate the entry point. For internal functions, use the <code>drsyms</code> Extension.</p>
<p>Function replacing is provided by <a class="el" href="group__drwrap.html#ga488a6566cd760a3919bdd2f49a6d672f">drwrap_replace()</a>. The replacement function executes as application code and will be passed to the client via the basic block and trace events just like any other application code. The replaced function may still show up in the basic block event as a jump instruction; none of its actual code will execute. To avoid changing application behavior, ensure that the replacement function mirrors the calling convention and other semantics of the original function.</p>
<p>Function wrapping is provided by <a class="el" href="group__drwrap.html#ga4c004987daae07af15f2146c2d7d4b09">drwrap_wrap()</a>. A pre-function and post-function callback must be provided. The pre-function callback is invoked prior to every execution of the target function. The callback can examine and change function arguments and can skip the call to the target function (in which case there will be no post-function callback). The post-function callback can examine and change the target function's return value. Information (included copies of the arguments for examination in the post-function) can be passed between the pre- and post-functions via a user-controlled parameter.</p>
<p>Multiple wrap requests are allowed for one target function. Their callbacks are called sequentially in the reverse order of registration. If any pre-function callback asks to skip the function, the remaining pre-function callbacks will not be called, nor will any post-function callback.</p>
<h2><a class="anchor" id="sec_drwrap_license">
LGPL 2.1 License</a></h2>
<p>The <code>drwrap</code> Extension is licensed under the LGPL 2.1 License and NOT the BSD license used for the rest of DynamoRIO. </p>
</div>
<hr size="1"><address style="text-align: center;"><small>
<img border=0 src="favicon.png"> &nbsp; DynamoRIO API version 3.2.0 --- Wed Mar 28 12:55:33 2012 
&nbsp; <img border=0 src="favicon.png">
</body>
</html>
