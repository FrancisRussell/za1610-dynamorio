<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>DynamoRIO API: Release Notes for Version 3.2.0</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
<link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />
</head><body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="contents">


<h1><a class="anchor" id="release_notes">Release Notes for Version 3.2.0 </a></h1><p>This section is divided into the following subsections:</p>
<ul>
<li><a class="el" href="release__notes.html#sec_package">Distribution Contents</a></li>
</ul>
<ul>
<li><a class="el" href="release__notes.html#sec_changes">Changes Since Prior Releases</a></li>
</ul>
<ul>
<li><a class="el" href="release__notes.html#sec_limits">Limitations</a></li>
</ul>
<ul>
<li><a class="el" href="release__notes.html#sec_future">Plans for Future Releases</a></li>
</ul>
 
<table width=100% bgcolor="#000000" cellspacing=0 cellpadding=2 border=0>
  <tr><td><table width=100% bgcolor="#0000C0" cellspacing=0 cellpadding=1 border=0>
  <tr><td><table width=100% bgcolor="#0000C0" cellspacing=0 cellpadding=1 border=0>
  <tr><td></td></tr></table></td></tr></table></td></tr></table>
 <h2><a class="anchor" id="sec_package">
Distribution Contents</a></h2>
<p>The following are part of the DynamoRIO release distribution:</p>
<ul>
<li>Four different DynamoRIO libraries: debug and release for each of 32-bit and 64-bit. The debug library enables assertion messages to more easily diagnose API usage errors.</li>
<li>Four different IA-32/AMD64 decoding static libraries: debug and release for each of 32-bit and 64-bit. The debug library enables assertion messages to more easily diagnose API usage errors.</li>
<li>The DynamoRIO configuration and execution libraries and command-line utilities <code>drconfiglib.dll</code>, <code>drinjectlib.dll</code>, <code>drconfig.exe</code>, <code>drrun.exe</code>, and <code>drinject.exe</code>. Windows package only.</li>
<li>A utility <code>drview.exe</code> for viewing which processes are running under DynamoRIO control. Windows package only.</li>
</ul>
<ul>
<li>The <code>drconfig</code>, <code>drrun</code>, and <code>drinject</code> scripts for configuring and running applications under DynamoRIO on Linux. Linux package only.</li>
</ul>
<ul>
<li>Header files for the DynamoRIO APIs.</li>
<li>This documentation.</li>
<li><a class="el" href="API__samples.html">Sample clients</a>.</li>
</ul>
<ul>
<li>A graphical statistics viewer <code>DRgui.exe</code> that displays internal DynamoRIO statistics as well as custom statistics defined by a client (see <a class="el" href="API__samples.html#sec_ex7">Use of Custom Client Statistics with the Windows GUI</a>). Windows package only. DynamoRIO exports a large number of statistics in its debug build, and a handful in release builds.</li>
</ul>
<ul>
<li>A binary tracedump reader, which also functions as a sample client using DynamoRIO as a standalone library (see <a class="el" href="page__standalone.html#sec_standalone">Using DynamoRIO as a Standalone Library</a>).</li>
</ul>
<p>When unpacking the release package on Windows, be aware that the Cygwin unzip utility does not preserve executable permissions properly. After unzipping, add ugo+rx permissions to all of the .dll and .exe files in the resulting directory tree: </p>
<div class="fragment"><pre class="fragment">find . -name \*.dll -exec chmod ugo+rx {} \; -o -name \*.exe -exec chmod ugo+rx {} \;
</pre></div> 
<table width=100% bgcolor="#000000" cellspacing=0 cellpadding=2 border=0>
  <tr><td><table width=100% bgcolor="#0000C0" cellspacing=0 cellpadding=1 border=0>
  <tr><td><table width=100% bgcolor="#0000C0" cellspacing=0 cellpadding=1 border=0>
  <tr><td></td></tr></table></td></tr></table></td></tr></table>
 <h2><a class="anchor" id="sec_changes">
Changes Since Prior Releases</a></h2>
<p>The current version is 3.2.0.</p>
<p>The changes between version 3.2.0 and 3.1.0 are:</p>
<ul>
<li>Added support for PECOFF + DWARF2 symbols on Windows in the drsyms Extension</li>
<li>Added support for building extensions as static libraries (subject to licensing constraints) via DR_EXT_{DRWRAP,DRUTIL,DRMGR,DRSYMS}_STATIC</li>
<li>Added support for linking C clients with libc via DynamoRIO_USE_LIBC</li>
<li>Added dr_insert_clean_call_ex()</li>
<li>Added a no-frills drwrap mode for faster but constrained wrapping</li>
<li>Added <a class="el" href="group__drwrap.html#ga92584c3e1980ac0c467de7d14d2bc2a2">drwrap_get_drcontext()</a> for performance</li>
<li>Added drwrap notification on exceptions bypassing post-hooks</li>
<li>Added <a class="el" href="group__drwrap.html#gaff6f66f7ec021cea150eb753f5db2b75">drwrap_wrap_ex()</a> to pass initial constant user data</li>
<li>Added <a class="el" href="group__drwrap.html#ga01e56e9bac8f584fe25e806a24769d50">drwrap_is_wrapped()</a> and <a class="el" href="group__drwrap.html#ga16fc2d260f5ebead724d5eb98bf13ac2">drwrap_is_post_wrap()</a></li>
<li>Added <a class="el" href="group__drwrap.html#gae2cc2affaf879182ba4d92299704c65f">drwrap_set_global_flags()</a> to control safety of application memory accesses</li>
<li>Added <a class="el" href="group__drwrap.html#gac3a79cf043d8c21dc190721d9fb105de">drwrap_get_mcontext_ex()</a> to avoid the cost of copying multimedia register values when not necessary</li>
<li>Added drwrap interface for caching post-call addresses</li>
<li>Added <a class="el" href="group__drmgr.html#ga357735ce7daa0bb717556455f20040a5">drmgr_decode_sysnum_from_wrapper()</a></li>
<li>Added <a class="el" href="group__drutil.html#gab75e6f41cd4ee5afaec592725abe1557">drutil_expand_rep_string_ex()</a> that returns additional information about string loop expansion</li>
<li>Added improved instrlist disassembly that includes labels and instruction targets</li>
<li>Added <a class="el" href="dr__ir__instr_8h.html#a25107e1fb5a49de3c627b70acc7b2eef">instr_compute_address_ex_pos()</a> for instrs with multiple memory operands.</li>
<li>Added <a class="el" href="dr__tools_8h.html#aae96ea91548daf1a0b5a78197bc86f07">dr_get_client_base()</a></li>
<li>Added <a class="el" href="dr__tools_8h.html#ad6b928d8cbc48fdf7d1d82c4fa95e40e">dr_vsnprintf()</a></li>
<li>Added service pack version to <a class="el" href="dr__tools_8h.html#abab30ef95ab36e4e885a9dc89f540c39">dr_get_os_version()</a></li>
<li>Added mediation of note fields to drmgr</li>
<li>Added custom storage in label instructions via <a class="el" href="dr__ir__instr_8h.html#a7eab5eaa85e186349d200a87e8010fec">instr_get_label_data_area()</a></li>
<li>Added support for multiple non-meta control transfer instructions with intra-block targets in one basic block to drmgr</li>
<li>Added user data passing support among all four passes of drmgr</li>
<li>Several bug fixes</li>
</ul>
<p>Version 3.0.0 was a development version. 3.1.0 is the first official released version of the 3.x series.</p>
<p>The changes between version 3.0.0 and 2.2.0 include the following major features:</p>
<ul>
<li>Added a private loader on Linux for better support for C++ clients and third-party library usage by clients</li>
<li>Added Linux support for <code>drsyms</code> to enable symbol processing in Linux clients</li>
<li>Added <code>drutil</code> Extension which provides memory address retrieval and string loop expansion (note: LGPL license)</li>
<li>Added a static library for decoding and encoding</li>
</ul>
<p><b>IMPORTANT:</b> The 3.0.0 and onward client API is mostly backward compatible with releases from 1.0.0 (originally called 0.9.6: see below) onward with the exception of functions that involve dr_mcontext_t and several other source and binary compatibility changes since version 2.2.0 described below. The dr_mcontext_t struct and all structs that contain it have changed and are NOT backward compatible with releases prior to 3.0.0.</p>
<p>A sample script for updating client sources to the 3.0.0 API's version of dr_mcontext_t and related functions is as follows:</p>
<div class="fragment"><pre class="fragment">perl -pi -e <span class="stringliteral">&#39;\</span>
<span class="stringliteral">s|dr_mcontext_t (\w+);|dr_mcontext_t \1 = {sizeof(\1),DR_MC_ALL,};|;\</span>
<span class="stringliteral">s|(dr_[gs]et_mcontext\(\S+,\s+\S+),\s+[^\s\)]+\)|\1)|;\</span>
<span class="stringliteral">s|(dr_redirect_execution\(\S+),\s+\S+\)|\1)|;\</span>
<span class="stringliteral">s|^\s+int app_errno;\s*\n||ms;\</span>
<span class="stringliteral">s|raw_mcontext\.|raw_mcontext-&gt;|g;\</span>
<span class="stringliteral">s|info-&gt;mcontext\.|info-&gt;mcontext-&gt;|g;\</span>
<span class="stringliteral">s|excpt-&gt;mcontext\.|excpt-&gt;mcontext-&gt;|g;&#39;</span> *.c
</pre></div><p>The script makes 3 main changes. First, any dr_mcontext_t allocated by the client must have its <code>size</code> and <code>flags</code> fields set. Second, the <code>app_errno</code> parameter was removed from several functions; it required a local variable, so any local named <code>app_errno</code> is removed. Third, the dr_mcontext_t fields in the fault, signal, and exception structs all became pointers.</p>
<p>This script may not catch all cases. Use your version control system to look at the diff after applying it to ensure it did not change anything it shouldn't have. Run with debug build to catch other instances where <a class="el" href="struct__dr__mcontext__t.html#a11c0a7fef86b59511a30b31718e3d5e1">dr_mcontext_t.size</a> is not set. Also note that using the dr_mcontext_t initialization syntax in the script will end up calling memset; for performance-critical situations, instead initialize only the size and flags fields separately. Also note that if the xmm or ymm registers are not needed, asking for DR_MC_CONTROL and/or DR_MC_INTEGER is more performant than DR_MC_ALL.</p>
<p><b>IMPORTANT:</b> Further changes between version 3.0.0 and 2.2.0 include the following that affect source and/or binary compatibilty:</p>
<ul>
<li>Changed the <a class="el" href="dr__defines_8h.html#a5d50a4225e834d67f66438669608e435">dr_mcontext_t</a> structure field layout. This is a binary compatibility change with respect to versions prior to 3.0.0.</li>
<li>Added a <a class="el" href="struct__dr__mcontext__t.html#a11c0a7fef86b59511a30b31718e3d5e1">dr_mcontext_t.size</a> field which must be set by the client prior to calling <a class="el" href="dr__ir__utils_8h.html#a91ffde2808c16e07f323c34affa72209">dr_get_mcontext()</a>, <a class="el" href="dr__ir__utils_8h.html#a56568d24667f5d64264d0bad398727b3">dr_set_mcontext()</a>, or dr_redirect_execution. This is a source compatibility change with respect to versions prior to 3.0.0.</li>
<li>Added a <a class="el" href="struct__dr__mcontext__t.html#a3aa9824f7e23cec6552859cc29af4b68">dr_mcontext_t.flags</a> field which must be set by the client prior to calling <a class="el" href="dr__ir__utils_8h.html#a91ffde2808c16e07f323c34affa72209">dr_get_mcontext()</a>, <a class="el" href="dr__ir__utils_8h.html#a56568d24667f5d64264d0bad398727b3">dr_set_mcontext()</a>, or dr_redirect_execution. This is a source compatibility change with respect to versions prior to 3.0.0.</li>
<li>Removed the app_errno parameter from <a class="el" href="dr__ir__utils_8h.html#a91ffde2808c16e07f323c34affa72209">dr_get_mcontext()</a>, <a class="el" href="dr__ir__utils_8h.html#a56568d24667f5d64264d0bad398727b3">dr_set_mcontext()</a>, and <a class="el" href="dr__ir__utils_8h.html#a9f612cf9d0ca2025b23d30b6f5bb0231">dr_redirect_execution()</a>. This is a source compatibility change with respect to versions prior to 3.0.0.</li>
<li>Changed all dr_mcontext_t fields in the dr_restore_state_info_t, dr_exception_t, and dr_siginfo_t structs to be pointers. This is a source compatibility change with respect to versions prior to 3.0.0.</li>
<li>Changed the bool typedef from int to char for C++ compatibility. This is a binary compatibility change with respect to versions prior to 3.0.0.</li>
<li>Changed the signature of <a class="el" href="group__drwrap.html#ga27894370f3da794ff3f31cb8d7ec079b">drwrap_unwrap()</a>, in order to allow one of the pre or post hooks to be optional (Issue 562). This is a source compatibility change with respect to versions prior to 3.0.0.</li>
<li>Moved console printing support from the drsyms Extension to core DR. The drsym_write_to_console() and drsym_using_console() are no longer supported. Instead, call <a class="el" href="dr__tools_8h.html#a712de67b3f6adb6778ce302925009753">dr_enable_console_printing()</a> in <a class="el" href="dr__api_8h.html#a20a4dc9da7f6bb9121e30bb3570c6961">dr_init()</a>, which then enables <a class="el" href="dr__tools_8h.html#abad2eddb3786e3e909ff36da39b7e31e">dr_printf()</a> and <a class="el" href="dr__tools_8h.html#afe7ede5b10890505021ac03e8f9ba97f">dr_fprintf()</a> to print to the console (with some limitations: see <a class="el" href="dr__tools_8h.html#a712de67b3f6adb6778ce302925009753">dr_enable_console_printing()</a> documentation). This is a source compatibility change with respect to versions prior to 3.0.0.</li>
<li>Added a <code>flags</code> argument to most of the routines in the <code>drsyms</code> extension to control demangling, and added <a class="el" href="group__drsyms.html#gad582a65dc1308335633e0c451035dbe0">drsym_demangle_symbol()</a>. This is a source compatibility change with respect to versions prior to 3.0.0.</li>
<li>Added <a class="el" href="group__drsyms.html#ga8b7f688e703f8ca1937f091f53d3d697">drsym_get_module_debug_kind()</a> and a <code>debug_kind</code> field to the <code>drsym_info_t</code> struct written by <a class="el" href="group__drsyms.html#ga201e8a9bf6746cbfd232bc4e4a243d2b">drsym_lookup_address()</a>. These additions allow drsyms users to determine what kind of debug info is available for a module. The <code>debug_kind</code> field creates a binary compatibility change for users of <code>drsym_info_t</code> with respect to versions prior to 3.0.0.</li>
</ul>
<p>Additional changes between version 3.0.0 and 2.2.0 include the following:</p>
<ul>
<li>Added <code>drvector</code> to drcontainers Extension: simple resizable vector</li>
<li>Added a windbg script for auto-locating libraries for easier debugging</li>
<li>Added <a class="el" href="dr__tools_8h.html#ae453a9c1ded7c8cd31d1a1aa2c8810af">dr_mutex_self_owns()</a> and recursive lock support (dr_recurlock_*) (Issue 219)</li>
<li>Added <a class="el" href="dr__tools_8h.html#af7d3a723c65e3762dd62b115577e0625">dr_map_file()</a>, <a class="el" href="dr__tools_8h.html#ae7f36900cafd048db5b8d34cf92faa45">dr_unmap_file()</a>, and <a class="el" href="dr__tools_8h.html#a06a8173579db03d018935afb1ca891f6">dr_file_size()</a> (Issue 542)</li>
<li>Added <a class="el" href="dr__tools_8h.html#ab23dff0c2d6d045cd938fc5f2c77a1ff">dr_rename_file()</a> and <a class="el" href="dr__tools_8h.html#a7ce7b5b2390cb5e03466cd605735bdfc">dr_delete_file()</a>.</li>
<li>Added routines to disassemble to a buffer rather than a file (Issue 524)</li>
<li>Added support for the AVX and FMA ISA extensions</li>
<li>Added <a class="el" href="dr__proc_8h.html#abf85cc821aab9850b8333eb32b953ca9">dr_insert_get_seg_base()</a></li>
<li>Added return value to <a class="el" href="dr__ir__utils_8h.html#a9f612cf9d0ca2025b23d30b6f5bb0231">dr_redirect_execution()</a> and <a class="el" href="dr__ir__utils_8h.html#a56568d24667f5d64264d0bad398727b3">dr_set_mcontext()</a></li>
<li>Increased maximum option string from 512 to 2048 (Issue 363)</li>
<li>Increased default stack size from 20KB to 56KB to make it easier to use C++ and external libraries with larger stack usage</li>
<li>Added <a class="el" href="dr__tools_8h.html#abab30ef95ab36e4e885a9dc89f540c39">dr_get_os_version()</a> (Issue 304)</li>
<li>Deprecated the "meta-instruction that can fault" property and <a class="el" href="dr__ir__instr_8h.html#a954715b40fa2668d7cde0c4a1bf47e51">instr_is_meta_may_fault()</a>, <a class="el" href="dr__ir__instr_8h.html#a94227a193446d370f0180e6a844be0c2">instr_set_meta_may_fault()</a>, <a class="el" href="dr__ir__utils_8h.html#affe811040a2962e5c6920a3c523212ab">instrlist_meta_fault_preinsert()</a>, <a class="el" href="dr__ir__utils_8h.html#a6ea095671bab4239c659d17d4a9cda56">instrlist_meta_fault_postinsert()</a>, and <a class="el" href="dr__ir__utils_8h.html#a94a1526c7b520c9aefbd775adfc57108">instrlist_meta_fault_append()</a>.</li>
<li>Added <a class="el" href="dr__tools_8h.html#a7ed94a2b046bb9ee777afe4f3ef1237f">dr_using_app_state()</a></li>
<li>Added <a class="el" href="dr__ir__instr_8h.html#a5356c2dd3388496158fa0a918f8c2a53">instr_encode_to_copy()</a> and <a class="el" href="dr__ir__instrlist_8h.html#a8ae48a113e137b95cd3499f9fa57f5ea">instrlist_encode_to_copy()</a></li>
<li>Added <a class="el" href="dr__ir__utils_8h.html#a3082c5db55039c72ae30e3276f622aae">disassemble_set_syntax()</a> for -syntax_intel control without runtime options and <a class="el" href="dr__proc_8h.html#a5a9d6c28ef304d6b4f5e1a45fb9da996">proc_set_vendor()</a> to control vendor-specific ISA details when decoding or encoding</li>
<li>Added <a class="el" href="dr__ir__instrlist_8h.html#a24c81467322f6eb86a8652ab1000fd2a">instrlist_set_fall_through_target()</a> and <a class="el" href="dr__ir__instrlist_8h.html#a71b0819b01546ec1b69063ba189a613e">instrlist_set_return_target()</a></li>
<li>Added <a class="el" href="group__drcontainers.html#ga2bcb10d265f6005bbcef89129ad58548">hashtable_clear()</a> to the drcontainers Extension</li>
<li>Several bug fixes</li>
</ul>
<p>The changes between version 2.2.0 and 2.1.0 are:</p>
<ul>
<li>Added <code>drwrap</code> Extension which provides function wrapping and replacing (note: LGPL license)</li>
<li>Added <code>drmgr</code> Extension: the DynamoRIO Multi-Instrumentation Manager Extension, a mediator for combining and coordinating multiple instrumentation passes</li>
<li>Added read-write locks (Issue 406)</li>
<li>Added isolation of client-opened files from the application (Issue 357)</li>
<li>Added <a class="el" href="struct__dr__mcontext__t.html#a740db0ec027db5080dc406c5e7127f01">dr_mcontext_t.xip</a> for syscall events (Issue 442)</li>
<li>Several bug fixes</li>
</ul>
<p>The changes between version 2.1.0 and 2.0.0 are:</p>
<ul>
<li>Added Windows 7 support</li>
<li>Added clean call sequence optimization and auto-inlining.</li>
<li>Added Windows child process following support for clients: -follow_children is now on by default for both Windows and Linux.</li>
<li>Added <a class="el" href="dr__tools_8h.html#adb9ba447c606e5e58400ac7b6ef719d1">DR_TRY_EXCEPT()</a> (Issue 51)</li>
<li>Added dynamic client auxiliary library loading support via <a class="el" href="dr__tools_8h.html#a94c8a2e52880f44d43402d6b0d686db2">dr_load_aux_library()</a>, <a class="el" href="dr__tools_8h.html#a814a1a50cc288dc902f2a2dcef9812c6">dr_lookup_aux_library_routine()</a>, and <a class="el" href="dr__tools_8h.html#a552563b1ccb84e3708041b276404d577">dr_unload_aux_library()</a></li>
<li>Added <a class="el" href="dr__tools_8h.html#aa2944aa54d591a236f5334a35bfb41bf">dr_switch_to_app_state()</a> and <a class="el" href="dr__tools_8h.html#a97ba972c50a47e7121c98652b461ae8e">dr_switch_to_dr_state()</a></li>
<li>Added <a class="el" href="dr__tools_8h.html#af57b95b87d8da29a16ca923a5b1b98b3">dr_client_thread_set_suspendable()</a></li>
<li>Added <a class="el" href="dr__tools_8h.html#aeb3d12bdde33dd279f09bcb2a5bfd901">dr_get_random_value()</a>, <a class="el" href="dr__tools_8h.html#a53bfa41e85c457ff39452a68eaf2281b">dr_set_random_seed()</a>, and <a class="el" href="dr__tools_8h.html#af3212441c8fd1642d6d1fb7850562106">dr_get_random_seed()</a></li>
<li>Added <a class="el" href="dr__tools_8h.html#af471633d0954d80c09ca6c2bfe40475b">dr_file_exists()</a> and <a class="el" href="dr__tools_8h.html#a02f86a68a105442a029baa05a1af9d57">dr_directory_exists()</a> for Linux</li>
<li>Added support for <a class="el" href="dr__ir__utils_8h.html#a91ffde2808c16e07f323c34affa72209">dr_get_mcontext()</a> from secondary thread init events, and changed its return type to bool</li>
<li>Added dynamic hashtable resizing to the drcontainers hashtable</li>
<li>Added <a class="el" href="dr__tools_8h.html#ac150776be7e338321cbb8edc49ab7790">dr_app_pc_from_cache_pc()</a></li>
<li>Added a segment list to module_data_t for Linux and internal support for non-contiguously-mapped modules (Issue 160)</li>
<li>Added PEB isolation (Issue 249) and <a class="el" href="dr__tools_8h.html#a81037ee313844d4fbce3368f4421e5b4">dr_get_app_PEB()</a></li>
<li>Added <a class="el" href="group__drsyms.html#ga260c78496165b54b9a97d0a5e1f6f4d8">drsym_enumerate_symbols()</a> to the <code>drsyms</code> Extension</li>
<li>Added limited support for printing to the cmd window (Issue 261) via the <code>drsyms</code> Extension: drsym_write_to_console() and drsym_using_console()</li>
<li>Renamed the REG_ constants to DR_REG_ to avoid conflicts with system headers (Issue 34). Clients should set(DynamoRIO_REG_COMPATIBILITY ON) prior to configure_DynamoRIO_client() to use the old constants and avoid any source changes; this will happen automatically if the client targets version 2.0 or earlier. Binary compatibility is unaffected.</li>
<li>Deprecated <a class="el" href="dr__tools_8h.html#a902bfca468a7a2cc3dbc45b4bd127444">dr_request_synchronized_exit()</a> and replaced it with <a class="el" href="dr__events_8h.html#acede43748af42c6334a19fc30e48c5f4">dr_set_process_exit_behavior()</a>. Now a full thread synch is performed at exit time in release build if a process exit event or thread exit event is registered. <a class="el" href="dr__events_8h.html#acede43748af42c6334a19fc30e48c5f4">dr_set_process_exit_behavior()</a> can provide more performant exit performance for clients that have flexible exit event requirements.</li>
<li>Switched debug build to also be an INTERNAL=ON build</li>
<li>Fixed bug in handling single-byte-bb selfmod code</li>
<li>Fixed bugs in handling alarm signals</li>
<li>Fixed 64-bit Windows stack alignment bug (Issue 331)</li>
<li>Fixed handling of "data32 rex.w call"</li>
<li>Fixed Issue 320: a problem with thread-private cache resizing</li>
<li>Fixed Issue 319: decode movlhps and movhlps properly</li>
<li>Fixed Issue 139: add xmm0-7 preservation for 32-bit Linux applications, which may have noticeable impacts on clients calling clean calls: e.g., pushing bbs over the max size limit or having a noticeable performance hit.</li>
<li>Support building sources using Visual Studio</li>
</ul>
<p>In version 2.0.0, the configuration and deployment API and tools changed and are not backward compatible with earlier versions: see below for details. The changes between version 2.0.0 and 1.5.0 are:</p>
<ul>
<li>Changed the configuration and deployment model for both Linux and Windows to use a configuration file based approach on both platforms, which adds control over child processes on Linux and supports local configuration on Windows for un-privileged and parallel execution (Issue 265). The registry is no longer used for individual application configuration on Windows other than to point at the location for global configuration files, when used.<br/>
 <b>IMPORTANT:</b> On Windows the following non-backward-compatible changes have been made:<ul>
<li>drdeploy.exe no longer exists (replaced by drconfig.exe and drrun.exe)</li>
<li>drconfig.dll is now drconfiglib.dll</li>
<li>drconfiglib.dll's API routines now take in a process id to support one-time targeted-process configuration (to support parallel execution)</li>
<li>configuration is either per-user or global, with per-user taking precedence when both exist</li>
<li>configuration does NOT enable systemwide injection by default: use the -syswide_on parameter to drconfig or drrun for that (it requires administrative privileges)</li>
</ul>
<b>IMPORTANT:</b> On Linux, if you're using custom injection via raw environment variables rather than using the <code>drdeploy</code> script, you must also set DYNAMORIO_RUNUNDER to 1 for injection to work with this release.</li>
<li>Added drinjectlib.dll and <a class="el" href="dr__inject_8h.html" title="Injection API for Windows. Use these functions to launch processes under the control...">dr_inject.h</a>, making custom injection tools easier to build (Issue 246)</li>
<li>Added DynamoRIO Extension support for auxiliary libraries that extend the DynamoRIO API (Issue 277)</li>
<li>Added symbol lookup support via Extension (Windows only for now) (Issue 44)</li>
<li>Added a "drcontainers" Extension that initially contains a hashtable</li>
<li>Added thread creation support: <a class="el" href="dr__tools_8h.html#ac6b80b83502ff13d4674b13e7b30b555">dr_create_client_thread()</a> (Issue 41)</li>
<li>Added <a class="el" href="dr__tools_8h.html#af154e498d8b185931ef970676cb65351">dr_sleep()</a></li>
<li>Added <a class="el" href="dr__tools_8h.html#a9191c67a267070ed51289d7192f986aa">dr_set_itimer()</a> and <a class="el" href="dr__tools_8h.html#ab5cd85ea911bd99dedbd8d05796260bc">dr_get_itimer()</a> (Linux-only) (Issue 283)</li>
<li>Added <a class="el" href="dr__tools_8h.html#acd67a10cd03a382853a0523bde9990f5">dr_app_pc_for_decoding()</a></li>
<li>Added -synch_at_exit option and <a class="el" href="dr__tools_8h.html#a902bfca468a7a2cc3dbc45b4bd127444">dr_request_synchronized_exit()</a> to provide guarantees over thread exit event timing in release build</li>
<li>Added <a class="el" href="dr__ir__instr_8h.html#a238dc0a1168701e30a95b57dd0c845a0">instr_cmovcc_triggered()</a> and <a class="el" href="dr__ir__instr_8h.html#a222195624605490e7844ed3737ad3668">instr_cmovcc_to_jcc()</a></li>
<li>Renamed OP_fcmovene to OP_fcmovne</li>
<li>Implemented <a class="el" href="dr__ir__instr_8h.html#acc25aa34b90fcf0cdcfdbd8028464274">instr_invert_cbr()</a> for OP_jcc_short</li>
<li>Added the full path to modules in module_data_t</li>
<li>Added <a class="el" href="dr__tools_8h.html#af1a068ad89408abbcfba026706810211">dr_get_proc_address_ex()</a> to support indirect code objects</li>
<li>Added <a class="el" href="dr__tools_8h.html#a4b187636a3fc9ba7964ae11a7fd30fb6">dr_get_milliseconds()</a> and <a class="el" href="dr__tools_8h.html#ae517c4817d67af6ad92b8f1d7694080a">dr_get_time()</a> impl for Linux</li>
<li>Added <a class="el" href="dr__ir__instr_8h.html#a465cc4935f184c4d224afbb9547a445c">instr_is_undefined()</a></li>
</ul>
<p>The changes between version 1.5.0 and 1.4.0 are:</p>
<ul>
<li>Added a private loader on Windows for better support for library usage by clients</li>
<li>Added nudge support on Linux</li>
<li>Added <a class="el" href="dr__tools_8h.html#a01fbe357fcc8352ba63c9a1a23e0c207">dr_suspend_all_other_threads()</a> and <a class="el" href="dr__tools_8h.html#a1193842150b09442a1b3c91f4e02d280">dr_resume_all_other_threads()</a></li>
<li>Made it easier for clients to use faults to push rare events out of instrumentation paths:<ul>
<li>Added access to the pre-translated context and the code fragment information for both <a class="el" href="dr__events_8h.html#a3ac512c0bd9feea08cb04dd923efb589">dr_register_signal_event()</a> and <a class="el" href="dr__events_8h.html#a69adae9409a1871149da69e97747b84c">dr_register_exception_event()</a> This changed the return type for exception event callbacks.</li>
<li>Added a signal/exception event on a fault in non-code-cache DynamoRIO code, such as client-generated code.</li>
<li>Added the "meta-instruction that can fault" property via <a class="el" href="dr__ir__instr_8h.html#a954715b40fa2668d7cde0c4a1bf47e51">instr_is_meta_may_fault()</a>, <a class="el" href="dr__ir__instr_8h.html#a94227a193446d370f0180e6a844be0c2">instr_set_meta_may_fault()</a>, <a class="el" href="dr__ir__utils_8h.html#affe811040a2962e5c6920a3c523212ab">instrlist_meta_fault_preinsert()</a>, <a class="el" href="dr__ir__utils_8h.html#a6ea095671bab4239c659d17d4a9cda56">instrlist_meta_fault_postinsert()</a>, and <a class="el" href="dr__ir__utils_8h.html#a94a1526c7b520c9aefbd775adfc57108">instrlist_meta_fault_append()</a>.</li>
<li>Added a new event <a class="el" href="dr__events_8h.html#a000e59a3f500a2d4a1d0123ce6032f77">dr_register_restore_state_ex_event()</a> that provides the pre-translated context and code fragment information, and allows for translation failure for non-fault translations.</li>
</ul>
</li>
<li>Added <a class="el" href="dr__tools_8h.html#a66ef4b43d78d787c7622569d30717051">dr_dup_file_handle()</a></li>
<li>Added <a class="el" href="dr__tools_8h.html#a813f98fcc06c0a1198262b744e98eced">dr_memory_is_dr_internal()</a> and <a class="el" href="dr__tools_8h.html#a2a67b03d64626f3d0a78b64bf096ed25">dr_memory_is_in_client()</a></li>
<li>Added <a class="el" href="dr__tools_8h.html#a11575b203a0558f5df50126ff04c4598">dr_get_parent_id()</a></li>
<li>Added <a class="el" href="dr__ir__utils_8h.html#a3952e7614f4bf8e62f360f08683ad8a0">decode_opcode_name()</a></li>
<li>Removed the deprecated snprintf() as it causes symbol pre-emption problems on Linux. Older clients should switch to <a class="el" href="dr__tools_8h.html#ab0c5f2529d9c076b5b0b0e92a70834b7">dr_snprintf()</a>.</li>
<li>Fixed bug in cross-architecture execve (Issue 146)</li>
<li>Clone record is now passed via dstack instead of ebp (Issue 149)</li>
<li>Fixed close() syscall handling, !HAVE_TLS assert &amp; minor issues (Issue 151)</li>
</ul>
<p>The changes between version 1.4.0 and 1.3.2 are:</p>
<ul>
<li>Added directly-addressable thread-local storage slots for exclusive client use:<ul>
<li><a class="el" href="dr__tools_8h.html#a95b53d79cae021a473c39f3b2662323f">dr_raw_tls_calloc()</a></li>
<li>dr_raw_tls_free()</li>
</ul>
</li>
<li>Provide 64-bit versions of the drdeploy.exe and drview.exe tools</li>
<li>Provide <a class="el" href="dr__tools_8h.html#a8da7923ecc4e020e31442bcc8d9f8d3e">dr_get_proc_address()</a> on Linux</li>
<li>Added <a class="el" href="dr__tools_8h.html#a5a6e4049f8accbc73ec5dbaf0deb25a7">dr_query_memory_ex()</a> to allow address space walking on Linux</li>
<li>Added -msgbox_mask on Linux: waits for a keypress<ul>
<li>Added STDIN and <a class="el" href="dr__tools_8h.html#aed162d7ad949b05fe8232771eaeca6a9">dr_get_stdin_file()</a></li>
</ul>
</li>
<li>Added shared library versioning on Linux</li>
<li>Support calling <a class="el" href="dr__ir__utils_8h.html#a91ffde2808c16e07f323c34affa72209">dr_get_mcontext()</a> from bb and trace callbacks</li>
<li>Provide support for building clients using CMake (see cmake/*, and for an example of usage see samples/CMakeLists.txt)</li>
<li>Provide support for clients to use -fvisibility by setting the define USE_VISIBILITY_ATTRIBUTES for <a class="el" href="dr__defines_8h.html" title="Basic defines and type definitions.">dr_defines.h</a></li>
<li>Added <a class="el" href="dr__ir__instr_8h.html#aa04322a189dd7f17ab245594e02cc6a8">instr_compute_address_ex()</a> for instrs with multiple memory operands</li>
<li>Provide <a class="el" href="dr__tools_8h.html#ab0c5f2529d9c076b5b0b0e92a70834b7">dr_snprintf()</a> (identical to snprintf()) for consistent naming and to avoid gcc warnings about using pointers with x (which we're using because there is no portable way to precisely control p)</li>
<li>The statistics viewer <code>DRgui.exe</code> is no longer supported on Windows NT. Statistics still work, but the graphical application itself will not run on NT.</li>
<li>Changed the top-level registry key to "DynamoRIO"</li>
<li>Re-arranged layout of bin and samples directories</li>
<li>Symbols for all binaries are now included</li>
</ul>
<p>The changes between version 1.3.2 and 1.3.1 are:</p>
<ul>
<li>Added support for Linux execve of cross-architectural executables (e.g., 32-bit process performing execve of 64-bit executable)<ul>
<li>Also, libdrpreload.so is now kept in the same libXX/{debug,release} directory as libdynamorio.so</li>
</ul>
</li>
<li><a class="el" href="dr__ir__instr_8h.html#a33a349e086f96bb03bd6700129dc6135">instr_convert_short_meta_jmp_to_long()</a> now returns the longer version of the taken jump, to use when setting the target of a jecxz or loop* branch.</li>
<li>Various bug fixes including in these areas:<ul>
<li><a class="el" href="dr__tools_8h.html#a601cd2b724ac627aef0756a4c4eee637">dr_syscall_set_result()</a> and <a class="el" href="dr__tools_8h.html#a76797a9310bf67ebeb820d80e11764b8">dr_syscall_invoke_another()</a></li>
<li>64-bit drinject stack alignment</li>
<li>64-bit erroneous assert in <a class="el" href="dr__tools_8h.html#a83b3658ca78e6b7adc81c57691f0fe50">dr_get_process_id()</a></li>
<li>64-bit dr_file_{tell,seek} worked but returned failure</li>
<li>-opt_memory bugs resulting in asserts</li>
<li>sigprocmask() corner case bug</li>
<li>signal handler sharing for NPTL threads</li>
<li>decoding across page boundaries on Linux</li>
</ul>
</li>
</ul>
<p>Version 1.3.1 is identical to 1.3.0 but is under a BSD license (see <a class="el" href="page__license.html">License</a>).</p>
<p>We re-numbered the previous DynamoRIO versions as follows:</p>
<ul>
<li>1.0.0 = 0.9.6 build 9600</li>
<li>1.1.0 = 0.9.6 build 9601</li>
<li>1.2.0 = 0.9.6 build 9602</li>
</ul>
<p>The changes between version 1.3.0 and version 1.2.0 (0.9.6 9602) are:</p>
<ul>
<li>Version numbering shift to 1.x.y instead of 0.9.6 960x</li>
<li>New system call pre, post, and filter events, and new system call parameter and result access, along with a feature to chain system calls:<ul>
<li><a class="el" href="dr__events_8h.html#aa37d61a7f9dde4663b8dd4c3a44732f4">dr_register_pre_syscall_event()</a></li>
<li><a class="el" href="dr__events_8h.html#a099441f8d147404355c66178e3b19f0f">dr_register_post_syscall_event()</a></li>
<li><a class="el" href="dr__events_8h.html#a7ec572232450344efcba8923cae71d51">dr_register_filter_syscall_event()</a></li>
<li><a class="el" href="dr__tools_8h.html#a1e01fe123ecc9908ada9c9fccbf3f6ab">dr_syscall_get_param()</a></li>
<li><a class="el" href="dr__tools_8h.html#ac21a83f1812443112303ef3ea8b76de2">dr_syscall_set_param()</a></li>
<li><a class="el" href="dr__tools_8h.html#abc80dfdf8bff3c3feb486aacd69aba7c">dr_syscall_set_sysnum()</a></li>
<li><a class="el" href="dr__tools_8h.html#ad12463724bf63a891e991891c72e6a4b">dr_syscall_get_result()</a></li>
<li><a class="el" href="dr__tools_8h.html#a601cd2b724ac627aef0756a4c4eee637">dr_syscall_set_result()</a></li>
<li><a class="el" href="dr__tools_8h.html#a76797a9310bf67ebeb820d80e11764b8">dr_syscall_invoke_another()</a></li>
<li><a class="el" href="dr__tools_8h.html#ac5804006579a63b49827169d3ffbebc8">dr_is_wow64()</a></li>
</ul>
</li>
<li>New signal event for Linux<ul>
<li><a class="el" href="dr__events_8h.html#a3ac512c0bd9feea08cb04dd923efb589">dr_register_signal_event()</a></li>
</ul>
</li>
<li>New option <a class="el" href="using.html#op_pause">-pause_on_error</a>, and error messages to stdout by default for release builds, to improve Linux debugging</li>
<li>New routines for memory allocation and memory manipulation:<ul>
<li><a class="el" href="dr__tools_8h.html#ac32b5be072876c25a832d510efeba6e4">dr_nonheap_alloc()</a></li>
<li><a class="el" href="dr__tools_8h.html#a401b819525f805d04e0a9560fdcfdf89">dr_nonheap_free()</a></li>
<li><a class="el" href="dr__tools_8h.html#a2c3a19a0dc146c1e5b6747e89bacfb55">dr_memory_protect()</a></li>
</ul>
</li>
<li>New option <a class="el" href="using.html#op_syntax_intel">-syntax_intel</a> for Intel-style disassembly</li>
<li>New option <a class="el" href="using.html#op_sysenter">-sysenter_is_int80</a></li>
<li>The parameter to an application's system call (normally kept in the eax register) can now be freely changed in basic blocks on all platforms</li>
<li>Added support for 64-bit -thread_private</li>
<li>Added corner-case undocumented IA-32 opcode support</li>
<li>Fixed bug running multi-threaded 64-bit Linux apps</li>
<li>Fixed bugs in 64-bit Linux signal handling</li>
<li>Fixed bug running -thread_private debug build</li>
<li>Fixed bug running 32-bit apps on 64-bit Linux on AMD processors</li>
<li>Fixed bug where OS_OPEN_APPEND overwrote instead of appending on Windows</li>
</ul>
<p>The changes between the 0.9.6 release builds 9602 and 9601 are:</p>
<ul>
<li>Performance improvements for both the base DynamoRIO system and for client instrumentation when running on Pentium M, Core, and Core 2 processors.</li>
<li>64-bit bug fixes</li>
<li>Added several convenience routines:<ul>
<li><a class="el" href="dr__ir__opnd_8h.html#a4b412ff3d08026f65ac44e1c6659a58a">get_register_name()</a></li>
<li><a class="el" href="dr__ir__opnd_8h.html#a9e132ba3dc1bad4b32a5c61e58ef010f">reg_to_pointer_sized()</a></li>
<li><a class="el" href="dr__ir__opnd_8h.html#a4780b2b04fe82ec06dc481d48cbbf6e5">reg_is_gpr()</a></li>
<li><a class="el" href="dr__ir__opnd_8h.html#a2a1c2869e0ff18940bfdbbd9e8771fb4">reg_is_segment()</a></li>
<li><a class="el" href="dr__ir__opnd_8h.html#a7a4d6e463a49f281c72eee9a61d48613">reg_32_to_8()</a></li>
</ul>
</li>
<li>Disassembly now expands immed sizes to match operands</li>
<li>Fixed bug in <a class="el" href="dr__ir__instr_8h.html#acb2c91a7868ad6a8e5c47af985edde61">instr_is_nop()</a></li>
</ul>
<p>The changes between the 0.9.6 release builds 9601 and 9600 are:</p>
<ul>
<li>The Windows registry key used is now "VMware, Inc." instead of "VMware"</li>
<li>Added large file support (see <a class="el" href="dr__tools_8h.html#a77a3b276c8d9a62bf6d78c3707d4effd">DR_FILE_ALLOW_LARGE</a>)</li>
<li>Added support for decoding from a copy of code: <a class="el" href="dr__ir__utils_8h.html#aad81737da9662a4e6bf697757cb25ddf">decode_from_copy()</a> and <a class="el" href="dr__ir__utils_8h.html#a2e6a5d44647c481f50ee5208281617ba">disassemble_from_copy()</a>.</li>
<li>Changed the default options to favor performance, and added the <a class="el" href="using.html#op_memory">-opt_memory</a> runtime option to prioritize memory instead.</li>
</ul>
<p>Release 0.9.6 is <b>not</b> backward compatible with prior releases 0.9.1-0.9.5.</p>
<p>The major changes between the 0.9.6 and 0.9.5 releases include 64-bit support, multiple clients, state translation, trace contents, and Linux module events and fast system calls:</p>
<ul>
<li>64-bit applications and clients are now supported. This changed several function signatures:<ul>
<li><a class="el" href="dr__ir__instr_8h.html#a1cd4d0740eb0a0bcd2d387685719263c">instr_encode()</a></li>
<li><a class="el" href="dr__ir__utils_8h.html#a813105fc7196a85e73580d1adfb8d336">decode_next_pc()</a></li>
<li><a class="el" href="dr__ir__utils_8h.html#a2a8b8756bdc063a88d206f17cc5e3e2c">decode_sizeof()</a></li>
<li><a class="el" href="dr__ir__utils_8h.html#aa9055369e97457b8656fc8c3c0d6d49d">decode_eflags_usage()</a></li>
<li><a class="el" href="dr__ir__instr_8h.html#a77b55daa2b3780d2c07e33b8330b2f62">instr_init()</a></li>
<li>The binary trace dump format changed.</li>
</ul>
Several new functions were added:<ul>
<li><a class="el" href="dr__ir__utils_8h.html#adf9a4f63eafc7f9725f7d5bf1725ab5c">set_x86_mode()</a></li>
<li><a class="el" href="dr__ir__utils_8h.html#aa18c8ca0720c97403a0fa9371ae792e5">get_x86_mode()</a></li>
<li><a class="el" href="dr__ir__instr_8h.html#a74814111812ff20b281f7350fb626746">instr_set_x86_mode()</a></li>
<li><a class="el" href="dr__ir__instr_8h.html#acf3a5a5abd40c0c0694f037fcfac5705">instr_get_x86_mode()</a></li>
<li><a class="el" href="dr__ir__opnd_8h.html#a429f69f7bc430cf278b5702818b25fcc">opnd_create_rel_addr()</a></li>
<li><a class="el" href="dr__ir__opnd_8h.html#a5378f9a33c968e32ac7ebc9acb8db3bb">opnd_create_far_rel_addr()</a></li>
<li><a class="el" href="dr__ir__opnd_8h.html#a17c7a1b3e5a6eecdfdb5bf69cdf2ecd4">opnd_is_rel_addr()</a></li>
<li><a class="el" href="dr__ir__opnd_8h.html#a9cc5a8653bef97653a0c5ff7355e9c00">opnd_is_near_rel_addr()</a></li>
<li><a class="el" href="dr__ir__opnd_8h.html#a4bddf944b64f391a3b02faa33fe4cb22">opnd_is_far_rel_addr()</a></li>
<li><a class="el" href="dr__ir__instr_8h.html#a7c2b7bfe6c9670ac127a24ea7aef33d4">instr_has_rel_addr_reference()</a></li>
<li><a class="el" href="dr__ir__instr_8h.html#a19b43ab8c3edd905329429075e91ea1a">instr_get_rel_addr_target()</a></li>
<li><a class="el" href="dr__ir__instr_8h.html#ae9e4c9cbe4890f8e37af9e299affc86c">instr_get_rel_addr_dst_idx()</a></li>
<li><a class="el" href="dr__ir__instr_8h.html#a8942eef70af97b8018b31df431ef1822">instr_get_rel_addr_src_idx()</a></li>
<li><a class="el" href="dr__ir__instr_8h.html#ae0db1cec99a6fff7dde7201a87ca8892">instr_shrink_to_32_bits()</a></li>
<li><a class="el" href="dr__ir__opnd_8h.html#a493afa708803ec99988e8e0f02a4b554">opnd_shrink_to_32_bits()</a></li>
<li><a class="el" href="dr__ir__opnd_8h.html#a6d6aa6e0596070095845e0214c4a08e8">reg_32_to_64()</a></li>
<li><a class="el" href="dr__ir__opnd_8h.html#a887f5c54d733c30ceb6a943d9a9427db">reg_64_to_32()</a></li>
<li><a class="el" href="dr__ir__opnd_8h.html#a80fb7f17bae1dc1cf6b8a45a9a3b42a3">reg_is_extended()</a></li>
<li><a class="el" href="dr__ir__opnd_8h.html#ae895cb370884b8acc4cdfc523f1101df">reg_parameter_num()</a></li>
</ul>
To build a 64-bit client, set the <code>X86_64</code> preprocessor define before including the DynamoRIO header files, and link with the 64-bit build of DynamoRIO (for a 32-bit client, set <code>X86_32</code>).</li>
<li>Multiple clients are now supported. This changed the signatures of <a class="el" href="dr__api_8h.html#a20a4dc9da7f6bb9121e30bb3570c6961">dr_init()</a>, <a class="el" href="dr__tools_8h.html#a10831623706378cfc3082c0e27e31c4c">dr_get_options()</a>, and <a class="el" href="dr__tools_8h.html#afb7d403eb032bd14ae78807ae3d59ea0">dr_get_client_path()</a>. It also changed how clients are deployed and nudged, and how events are unregistered: explicit unregistration routines are now used.</li>
<li>State translation in the presence of clients is now fully supported. This changed the signature for the basic block and trace event callbacks (see <a class="el" href="dr__events_8h.html#a043a3588c4cf0c2d6838140fce530e72">dr_register_bb_event()</a> and <a class="el" href="dr__events_8h.html#a88a19a6822654caf18c017e145f48a57">dr_register_trace_event()</a>), added a new event <a class="el" href="dr__events_8h.html#ae7a179ac7a2d01157e1ab2852f50c902">dr_register_restore_state_event()</a>, and added new functions <a class="el" href="dr__ir__instr_8h.html#af1beda2d570ba04d74ca9cbd7c31bb1d">instr_set_translation()</a>, <a class="el" href="dr__ir__instr_8h.html#a5206d055a5b06435bd5e919da40e8bd4">instr_set_meta_no_translation()</a>, and <a class="el" href="dr__ir__macros_8h.html#ad21fbdff8a5631b3e31b8221180a2a9c">INSTR_XL8()</a>.</li>
<li>The trace callback (<a class="el" href="dr__events_8h.html#a88a19a6822654caf18c017e145f48a57">dr_register_trace_event()</a>) now presents original application code to the client, rather than code that has already been modified for execution in the code cache. The client also has flexibility in which instrumentation is included from constituent basic blocks added to a trace (the <code>for_trace</code> parameter: see <a class="el" href="dr__events_8h.html#a043a3588c4cf0c2d6838140fce530e72">dr_register_bb_event()</a>).</li>
<li>Fast system calls (syscall and sysenter) are now supported on Linux.</li>
<li>Module load/unload events and module iteration are now supported on Linux.</li>
<li>System calls for 32-bit applications on 64-bit kernels are no longer hidden by vsyscall; related functions were removed: instr_is_lol64_syscall(), instr_is_32on64_syscall().</li>
<li>Due to both 64-bit support and full WOW64 (32-bit applications on 64-bit Windows) support, xmm registers were added to dr_mcontext_t, and a new function <a class="el" href="dr__ir__utils_8h.html#a5921c4f301ea05885f305f9a30b3c0b0">dr_mcontext_xmm_fields_valid()</a> was added.</li>
<li>Far instr-type operands are now supported: <a class="el" href="dr__ir__opnd_8h.html#a95f47d1d589d4a9566a581588fecaedf">opnd_create_far_instr()</a>, <a class="el" href="dr__ir__opnd_8h.html#aee97636116eb65baace7ccd74b8d1083">opnd_is_near_instr()</a>, <a class="el" href="dr__ir__opnd_8h.html#a93533e9bd0ad51af0f0f8d10535a7b0e">opnd_is_far_instr()</a>.</li>
<li>Miscellaneous new functions were added:<ul>
<li><a class="el" href="dr__ir__instr_8h.html#a33a349e086f96bb03bd6700129dc6135">instr_convert_short_meta_jmp_to_long()</a></li>
<li><a class="el" href="dr__ir__instr_8h.html#a5229b3775a4b2cdaa9aa257a27a0be1a">instr_reads_from_reg()</a></li>
<li><a class="el" href="dr__ir__macros_8h.html#a8104e895719c1f3a8558067b023cf9c5">LOCK()</a></li>
<li><a class="el" href="dr__ir__macros_8h.html#a39cadf7c35d28a1dedf9b945cf1aa656">OPND_CREATE_INT_32OR8()</a></li>
<li><a class="el" href="dr__ir__macros_8h.html#a4cb280d756b701b7b2379045b51b0d5a">OPND_CREATE_INT_16OR8()</a></li>
<li><a class="el" href="dr__ir__utils_8h.html#a824eaa9075a7aaf443b4cc4180eec81e">instrlist_meta_append()</a></li>
<li><a class="el" href="dr__tools_8h.html#a54934632c814904bd9e0ce9c83980466">dr_using_all_private_caches()</a></li>
</ul>
</li>
<li>The type of nudge arguments was changed from (void *) to uint64.</li>
<li>The signature of <a class="el" href="dr__tools_8h.html#a4892d089da710e952a23055bd7db38af">dr_lookup_module()</a> changed. It no longer has an IMAGE_SECTION_HEADER out argument. See <a class="el" href="dr__tools_8h.html#ac520aa05555ecbf9e525de582d4baa8c">dr_lookup_module_section()</a> for that functionality.</li>
<li>The disassemble-from-address routines now return NULL when pointed at invalid instructions (matching the decode routines).</li>
<li>The routines to access DynamoRIO tls slots from the cache were changed. dr_insert_write_temp_tls was eliminated in favor of a generalized <a class="el" href="dr__ir__utils_8h.html#af294ac021c84f5ec47230ee7df0e6c02">dr_save_reg</a> with more flexibility on which slot can be used. <a class="el" href="dr__ir__utils_8h.html#a44636ca6809a9fb22cf817701de9ee09">dr_save_arith_flags</a> was similarly generalized. Slots are now guaranteed to remain valid until the next non-meta instruction allowing access to saved registers during clean calls via <a class="el" href="dr__ir__utils_8h.html#abb63ecfaa5256688bab9a2921fc19227">dr_read_saved_reg</a> and <a class="el" href="dr__ir__utils_8h.html#abf8d50d718883a1caf6a2de0fb3dbce3">dr_write_saved_reg</a>. <a class="el" href="dr__ir__utils_8h.html#a919e2106df67eaaa5bc6c49d736543b5">dr_insert_mbr_instrumentation</a> also now requires caller to specify the spill slot to be clobbered which must be less than <a class="el" href="dr__ir__utils_8h.html#a762389f8ae9d809fd7b8f1418cdbd5ae">dr_max_opnd_accessible_spill_slot()</a>.</li>
</ul>
<p>The major changes between the 0.9.5 and 0.9.4 releases are:</p>
<ul>
<li>The basic block hook (<a class="el" href="API__BT.html#sec_events_bb">Basic Block Creation</a>) passes completely unmodified application code to the client (no mangling or elision).</li>
<li>The old client hook exports have been replaced with an explicit event registration model.</li>
<li>Instruction representation simplification: the client only sees fully decoded instructions.</li>
<li>Easier-to-use clean calls (see <a class="el" href="dr__ir__utils_8h.html#ae7b7bd1e750b8a24ebf401fb6a6d6d5e">dr_insert_clean_call</a>).</li>
<li>Library support (-wrap on linux, ntdll on windows: see <a class="el" href="using.html#sec_extlibs">Using External Libraries</a> and <a class="el" href="using.html#sec_utils">Common Utilities</a>).</li>
<li>Some features have been removed (these are easily implemented by a client): there is no more edge-counting profile build, no more custom exit stubs, and no more prefixes.</li>
<li>Infrastructure improvements:<ul>
<li>Thread-shared caches (can still request thread-private: <a class="el" href="using.html#op_thread_priv">-thread_private option</a>). Note that there are some subtle changes stemming from using thread-shared: in particular, note that the context passed to the deletion event may be NULL (see <a class="el" href="dr__events_8h.html#a698501b03d64f07e1a32fc82c021b27a">dr_register_delete_event</a>).</li>
<li>Direct access to TLS slots (<a class="el" href="dr__ir__utils_8h.html#af294ac021c84f5ec47230ee7df0e6c02">dr_save_reg</a>, dr_insert_write_temp_tls, <a class="el" href="dr__ir__utils_8h.html#a982089284bd51339f448ec4b3928d3b4">dr_insert_write_tls_field</a>).</li>
</ul>
</li>
<li>Module events (<a class="el" href="dr__events_8h.html#aca6b098123ef80cae05ce767a7dd9d98">dr_register_module_load_event</a>), module iteration (<a class="el" href="dr__tools_8h.html#a3310b1bfc22da285af72b1a4a9d10945">dr_module_iterator_start</a>, <a class="el" href="dr__tools_8h.html#a4892d089da710e952a23055bd7db38af">dr_lookup_module</a>, etc.), and memory querying (<a class="el" href="dr__tools_8h.html#ad158d2822dd8bb9caa9604d84b666bfa">dr_query_memory</a>, <a class="el" href="dr__tools_8h.html#a55ca77553e86a0656dc186ae3fc8222f">dr_virtual_query</a>).</li>
<li>The full API is now documented in html and pdf for easy browsing.</li>
<li>Numerous type and routine name changes.</li>
</ul>
 
<table width=100% bgcolor="#000000" cellspacing=0 cellpadding=2 border=0>
  <tr><td><table width=100% bgcolor="#0000C0" cellspacing=0 cellpadding=1 border=0>
  <tr><td><table width=100% bgcolor="#0000C0" cellspacing=0 cellpadding=1 border=0>
  <tr><td></td></tr></table></td></tr></table></td></tr></table>
 <h2><a class="anchor" id="sec_limits">
Limitations</a></h2>
<h3><a class="anchor" id="sec_limit_clients">
Client Limitations</a></h3>
<p>The most important limitation on a client is that it remain transparent. This is described fully in <a class="el" href="transparency.html">Client Transparency</a>. Here we summarize the key points to remain transparent:</p>
<ul>
<li>For full transparency, the client should be a self-contained library with linkage to nothing other than DynamoRIO libraries. We provide private loading that makes some use of system libraries safe, but global resource conflicts can still occur and clients are cautioned from using system-interacting library routines. See <a class="el" href="using.html#sec_extlibs">Using External Libraries</a> for further details.</li>
<li>Currently, the communication API provided by DynamoRIO is limited to file I/O and nudges.</li>
</ul>
<h3><a class="anchor" id="sec_limit_platforms">
Platform Limitations</a></h3>
<ul>
<li>DynamoRIO currently supports the following NT-based 32-bit Windows systems : NT (all service packs), 2000 (all service packs), XP (32-bit, service packs 0-3), 2003 (32-bit, service packs 0-2), Vista (32-bit, service packs 0-1), and Windows 7 (32-bit, service packs 0-1). It does not support Windows 95, 98, or ME. Windows Server 2008 is likely to work but has not been tested.</li>
<li>This release of DynamoRIO has limited support for running 32-bit Windows applications on the following 64-bit Windows operating systems : Windows XP Professional x64 (service pack 2), Windows 2003 x64 (service pack 2), Vista x64 (service packs 0-1), and Windows 7 (service packs 0-1). Windows Server 2008 is likely to work but has not been tested. Only the 32-bit code will be seen, and child processes created will not be injected into. On 64-bit Windows 32-bit applications are automatically run through the Windows-On-Windows or WOW64 emulator so system call and indirect call processing clients must be aware of <a class="el" href="dr__ir__instr_8h.html#a4a4d5454f266483029bd88e5a17e398c">instr_is_wow64_syscall()</a>. <a class="anchor" id="limits_64bit"></a></li>
<li>This release of DynamoRIO supports running 64-bit Windows applications, using the 64-bit DynamoRIO build, on the following 64-bit Windows systems: Windows XP Professional x64 (service pack 2), Windows 2003 x64 (service pack 2), Vista x64 (service packs 0-1), and Windows 7 x64 (service packs 0-1). Windows Server 2008 is likely to work but has not been tested.</li>
<li>DynamoRIO does not support any Itanium based Windows systems.</li>
<li>This release does not fully support applications that mix 32-bit and 64-bit code. Future releases will support such mixtures.</li>
<li>When running a cygwin application under control of DynamoRIO, stderr and stdout output from DynamoRIO or its clients may not be visible.</li>
<li>The statistics viewer <code>DRgui.exe</code> is no longer supported on Windows NT. Statistics still work, but the graphical application itself will not run on NT.</li>
</ul>
<ul>
<li>This release of DynamoRIO has support for most 32-bit and 64-bit Linux distributions running on Intel-compatible hardware, including Ubuntu and Fedora.</li>
<li>This release of DynamoRIO has support for running 32-bit Linux applications on 64-bit Linux operating systems on AMD64-compatible hardware.</li>
<li>Cross-architecture execve (e.g., a 32-bit process performing execve of a 64-bit executable) may stop working if the paths to the libdynamrio.so and libdrpreload.so libraries are renamed.</li>
</ul>
<h3><a class="anchor" id="sec_limit_perf">
Performance Limitations</a></h3>
<ul>
<li>In order to present a more straightforward code stream to clients, DynamoRIO has several optimizations disabled in this release. System-call-heavy applications are the ones most likely to be affected. Future releases may allow clients to choose performance versus visibility. This release does provide the <a class="el" href="using.html#op_memory">-opt_memory option</a> to enable prioritizing memory usage.</li>
<li>The performance when starting up large desktop applications may be noticeably worse than native. Upcoming releases will address this issue.</li>
</ul>
<ul>
<li>The performance when running Java, .Net, Flash or similar managed execution applications can be noticeably worse then native. This can include applications that load these components as in-process plugins (such as Internet Explorer). Upcoming releases will address this issue.</li>
</ul>
<ul>
<li>When using DynamoRIO on all or many processes on a system simultaneously, memory usage may become a factor. Upcoming releases will address this issue.</li>
</ul>
<h3><a class="anchor" id="sec_limit_deploy">
Deployment Limitations</a></h3>
<ul>
<li>The dr_config.lib library is not multi-thread safe. Users of the library should ensure that no more then one thread accesses the library at a time.</li>
<li>Other installed software that uses hooks may not always be interoperable with DynamoRIO.</li>
<li>Other installed software may conflict with DynamoRIO's use of the <code>\HKLM\SOFTWARE\Microsoft\Windows\WindowsNT\CurrentVersion\AppInit_DLLs</code> registry key (only very rarely an issue).</li>
<li>On Windows 7 and Windows Server 2008 R2, the digital signature requirement for AppInit_DLLs libraries is disabled when systemwide injection is requested. This can be a security concern.</li>
<li>Cygwin processes may not work with DynamoRIO due to cygwin's implementation of fork being incompatible with DynamoRIO.</li>
<li>Though DynamoRIO supports running on Windows NT, the provided installer will only run on Windows 2000 and higher. After installation on a 2000 or higher machine the <a class="el" href="release__notes.html#sec_package">Distribution Contents</a> may be copied to the NT machine for use there.</li>
<li>On Windows NT, a reboot is required after the initial <a class="el" href="dr__config_8h.html#a303f226bbb38a435a622e9186627b427">dr_register_process()</a> in order for DynamoRIO to take control of any applications. The reboot will not change or undo the registration.</li>
<li>A Windows application that does not statically link with user32.dll will not be run under control of DynamoRIO unless its parent process (typically cmd.exe or explorer.exe, for manually launched applications) is already under DynamoRIO control or the drinject.exe utility is used to launch the application. Only some small non-graphical applications do not link with user32.dll.</li>
<li>When invoking an application in any way that is not from a parent process under DynamoRIO control, DynamoRIO takes control a little later and in some rare cases the application has already created a new thread. This is in violation of the Windows specficiations, but cygwin processes do this. This new thread will not be under DynamoRIO control and can cause a variety of problems. In such cases it is best to invoke from a parent process under DynamoRIO control. However, for 32-bit applications on 64-bit Windows operating systems, DynamoRIO takes over later even from the parent. Future releases will address this limitation.</li>
<li>This release does not support running some Windows services under control of DynamoRIO: System, smss.exe, csrss.exe, and protected processes on Windows Vista.</li>
<li>This release does not support nudging 64-bit processes. <a class="anchor" id="limits_vista_service_messagebox"></a></li>
<li>On Windows Vista most services are run in a separate session as a security feature. This means that neither DynamoRIO nor its client will be able to display a messagebox when running in said services (they have no associated visible window station). See <a class="el" href="dr__tools_8h.html#ad444a204e7ca45f9965cfe973470375a">dr_messagebox()</a>.</li>
<li>On Windows Vista the code from certain dlls (found mostly in services) and the code subsequently called from those dlls is run natively and is not visible to the instrumentation APIs. This only applies to dlls that have a .pexe section (only 13 dlls have such a section in a standard Vista install) which seems to be associated with a likely obfuscation method involving kernel side components that this release has no other workaround for.</li>
</ul>
<p><a class="anchor" id="limits_linux_preload"></a></p>
<ul>
<li>On Linux, the only provided deployment method in this release (aside from the <a class="el" href="API__BT.html#sec_startstop">app_start() app_stop()</a> interface, which requires soure code modification) is LD_PRELOAD. This means that static binaries cannot be injected into. Also, binaries with the suid or sgid permission bits set disallow absolute paths in LD_PRELOAD and ignore LD_LIBRARY_PATH, so alternate methods of specifying the path are needed there. One method is to place libdrpreload.so's full path in /etc/ld.so.preload and copy libdynamorio.so to /usr/lib or some other system search directory. You'll need to use a <a class="el" href="using.html#lin_deploy">separate configure step approach</a>. Don't forget to run drconfig to create a configuration for the application first; otherwise, libdrpreload.so will refuse to take control.</li>
</ul>
 
<table width=100% bgcolor="#000000" cellspacing=0 cellpadding=2 border=0>
  <tr><td><table width=100% bgcolor="#0000C0" cellspacing=0 cellpadding=1 border=0>
  <tr><td><table width=100% bgcolor="#0000C0" cellspacing=0 cellpadding=1 border=0>
  <tr><td></td></tr></table></td></tr></table></td></tr></table>
 <h2><a class="anchor" id="sec_future">
Plans for Future Releases</a></h2>
<p>We hope to include the following major features in future releases:</p>
<ul>
<li>Libraries to facilitate building tools that use shadow memory, examine system calls, and insert heavyweight instrumentation</li>
<li>Earliest Windows injection. Today drinject injects fairly late; from a parent process, injection is very early (before kernel32.dll is loaded), but we plan to provide injection at the very first user-mode instruction in the future.</li>
<li>More flexible (earlier, or later via attach) Linux injection</li>
<li>Persistent and process-shared code caches</li>
<li>Full control over trace building</li>
</ul>
<p>To discuss current and future features, join the <a href="http://groups.google.com/group/dynamorio-users/">DynamoRIO Users group</a>. </p>
</div>
<hr size="1"><address style="text-align: center;"><small>
<img border=0 src="favicon.png"> &nbsp; DynamoRIO API version 3.2.0 --- Wed Mar 28 12:55:33 2012 
&nbsp; <img border=0 src="favicon.png">
</body>
</html>
